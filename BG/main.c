#include <stdio.h>
#include <rand.h>

#include <gb/gb.h>

#include "../define.h"

#define C0 0
#define C1 1
#define C2 2
#define C3 3

#define M0 1
#define M1 2

#define P(c, m, b) PATTERN(c, m, b)
const uint8_t Patterns[] = {
    //!< パターン 0
    P(C0, M0, 7) | P(C0, M0, 6) | P(C0, M0, 5) | P(C1, M0, 4) | P(C1, M0, 3) | P(C0, M0, 2) | P(C0, M0, 1) | P(C0, M0, 0),
    P(C0, M1, 7) | P(C0, M1, 6) | P(C0, M1, 5) | P(C1, M1, 4) | P(C1, M1, 3) | P(C0, M1, 2) | P(C0, M1, 1) | P(C0, M1, 0),
    P(C0, M0, 7) | P(C0, M0, 6) | P(C1, M0, 5) | P(C1, M0, 4) | P(C1, M0, 3) | P(C1, M0, 2) | P(C0, M0, 1) | P(C0, M0, 0),
    P(C0, M1, 7) | P(C0, M1, 6) | P(C1, M1, 5) | P(C1, M1, 4) | P(C1, M1, 3) | P(C1, M1, 2) | P(C0, M1, 1) | P(C0, M1, 0),
    P(C0, M0, 7) | P(C1, M0, 6) | P(C1, M0, 5) | P(C1, M0, 4) | P(C1, M0, 3) | P(C1, M0, 2) | P(C1, M0, 1) | P(C0, M0, 0),
    P(C0, M1, 7) | P(C1, M1, 6) | P(C1, M1, 5) | P(C1, M1, 4) | P(C1, M1, 3) | P(C1, M1, 2) | P(C1, M1, 1) | P(C0, M1, 0),
    P(C1, M0, 7) | P(C1, M0, 6) | P(C0, M0, 5) | P(C1, M0, 4) | P(C1, M0, 3) | P(C0, M0, 2) | P(C1, M0, 1) | P(C1, M0, 0),
    P(C1, M1, 7) | P(C1, M1, 6) | P(C0, M1, 5) | P(C1, M1, 4) | P(C1, M1, 3) | P(C0, M1, 2) | P(C1, M1, 1) | P(C1, M1, 0),
    P(C1, M0, 7) | P(C1, M0, 6) | P(C1, M0, 5) | P(C1, M0, 4) | P(C1, M0, 3) | P(C1, M0, 2) | P(C1, M0, 1) | P(C1, M0, 0),
    P(C1, M1, 7) | P(C1, M1, 6) | P(C1, M1, 5) | P(C1, M1, 4) | P(C1, M1, 3) | P(C1, M1, 2) | P(C1, M1, 1) | P(C1, M1, 0),
    P(C0, M0, 7) | P(C0, M0, 6) | P(C1, M0, 5) | P(C0, M0, 4) | P(C0, M0, 3) | P(C1, M0, 2) | P(C0, M0, 1) | P(C0, M0, 0),
    P(C0, M1, 7) | P(C0, M1, 6) | P(C1, M1, 5) | P(C0, M1, 4) | P(C0, M1, 3) | P(C1, M1, 2) | P(C0, M1, 1) | P(C0, M1, 0),
    P(C0, M0, 7) | P(C1, M0, 6) | P(C0, M0, 5) | P(C1, M0, 4) | P(C1, M0, 3) | P(C0, M0, 2) | P(C1, M0, 1) | P(C0, M0, 0),
    P(C0, M1, 7) | P(C1, M1, 6) | P(C0, M1, 5) | P(C1, M1, 4) | P(C1, M1, 3) | P(C0, M1, 2) | P(C1, M1, 1) | P(C0, M1, 0),
    P(C1, M0, 7) | P(C0, M0, 6) | P(C1, M0, 5) | P(C0, M0, 4) | P(C0, M0, 3) | P(C1, M0, 2) | P(C0, M0, 1) | P(C1, M0, 0),
    P(C1, M1, 7) | P(C0, M1, 6) | P(C1, M1, 5) | P(C0, M1, 4) | P(C0, M1, 3) | P(C1, M1, 2) | P(C0, M1, 1) | P(C1, M1, 0),

    //!< パターン 1
    P(C0, M0, 7) | P(C0, M0, 6) | P(C0, M0, 5) | P(C0, M0, 4) | P(C2, M0, 3) | P(C2, M0, 2) | P(C0, M0, 1) | P(C0, M0, 0),
    P(C0, M1, 7) | P(C0, M1, 6) | P(C0, M1, 5) | P(C0, M1, 4) | P(C2, M1, 3) | P(C2, M1, 2) | P(C0, M1, 1) | P(C0, M1, 0),
    P(C0, M0, 7) | P(C0, M0, 6) | P(C0, M0, 5) | P(C0, M0, 4) | P(C2, M0, 3) | P(C0, M0, 2) | P(C0, M0, 1) | P(C0, M0, 0),
    P(C0, M1, 7) | P(C0, M1, 6) | P(C0, M1, 5) | P(C0, M1, 4) | P(C2, M1, 3) | P(C0, M1, 2) | P(C0, M1, 1) | P(C0, M1, 0),
    P(C0, M0, 7) | P(C2, M0, 6) | P(C2, M0, 5) | P(C2, M0, 4) | P(C2, M0, 3) | P(C2, M0, 2) | P(C2, M0, 1) | P(C0, M0, 0),
    P(C0, M1, 7) | P(C2, M1, 6) | P(C2, M1, 5) | P(C2, M1, 4) | P(C2, M1, 3) | P(C2, M1, 2) | P(C2, M1, 1) | P(C0, M1, 0),
    P(C2, M0, 7) | P(C2, M0, 6) | P(C2, M0, 5) | P(C2, M0, 4) | P(C2, M0, 3) | P(C2, M0, 2) | P(C2, M0, 1) | P(C2, M0, 0),
    P(C2, M1, 7) | P(C2, M1, 6) | P(C2, M1, 5) | P(C2, M1, 4) | P(C2, M1, 3) | P(C2, M1, 2) | P(C2, M1, 1) | P(C2, M1, 0),
    P(C2, M0, 7) | P(C0, M0, 6) | P(C2, M0, 5) | P(C2, M0, 4) | P(C2, M0, 3) | P(C2, M0, 2) | P(C2, M0, 1) | P(C2, M0, 0),
    P(C2, M1, 7) | P(C0, M1, 6) | P(C2, M1, 5) | P(C2, M1, 4) | P(C2, M1, 3) | P(C2, M1, 2) | P(C2, M1, 1) | P(C2, M1, 0),
    P(C2, M0, 7) | P(C0, M0, 6) | P(C2, M0, 5) | P(C2, M0, 4) | P(C2, M0, 3) | P(C2, M0, 2) | P(C2, M0, 1) | P(C2, M0, 0),
    P(C2, M1, 7) | P(C0, M1, 6) | P(C2, M1, 5) | P(C2, M1, 4) | P(C2, M1, 3) | P(C2, M1, 2) | P(C2, M1, 1) | P(C2, M1, 0),
    P(C2, M0, 7) | P(C2, M0, 6) | P(C2, M0, 5) | P(C2, M0, 4) | P(C2, M0, 3) | P(C2, M0, 2) | P(C2, M0, 1) | P(C2, M0, 0),
    P(C2, M1, 7) | P(C2, M1, 6) | P(C2, M1, 5) | P(C2, M1, 4) | P(C2, M1, 3) | P(C2, M1, 2) | P(C2, M1, 1) | P(C2, M1, 0),
    P(C0, M0, 7) | P(C2, M0, 6) | P(C2, M0, 5) | P(C2, M0, 4) | P(C2, M0, 3) | P(C2, M0, 2) | P(C2, M0, 1) | P(C0, M0, 0),
    P(C0, M1, 7) | P(C2, M1, 6) | P(C2, M1, 5) | P(C2, M1, 4) | P(C2, M1, 3) | P(C2, M1, 2) | P(C2, M1, 1) | P(C0, M1, 0),
};
#undef P
#undef M1
#undef M0
#undef C3
#undef C2
#undef C1
#undef C0

const uint8_t Tiles[] = {
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
};

void main()
{
    disable_interrupts(); {
        SHOW_BKG;
        //!< BG パレット
        BGP_REG = DEFAULT_PALETTE;
        //!< BG パターン
        set_bkg_data(0, COUNTOF(Patterns), Patterns);

        DISPLAY_OFF; {
            //!< BG ネームテーブル (マップ)
            set_bkg_tiles(0, 0, COUNTOF(Tiles) >> 5, 32, Tiles);
            //set_bkg_submap(10, 10, 10, 10, bigmap_map, bigmap_mapWidth);
        } DISPLAY_ON;
        
    } enable_interrupts();
    
    fixed x = { 0 }, y = { 0 };
    while(1) {
        wait_vbl_done();

        const uint8_t KeyState = joypad();
        const uint8_t Speed = 128;
        if(KeyState & J_UP) { y.w -= Speed; }
        if(KeyState & J_RIGHT) { x.w += Speed; }
        if(KeyState & J_DOWN) { y.w += Speed; }
        if(KeyState & J_LEFT) { x.w -= Speed; }

        #if 1
        move_bkg(x.b.h, y.b.h);
        #else
        SCX_REG = x.b.h;
        SCY_REG = y.b.h;
        #endif
    }
}
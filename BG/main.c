#include <stdio.h>
#include <rand.h>

#include <gb/gb.h>

#include "../define.h"

#define BK 0
#define C0 1
#define C1 2
#define C2 3

#define M0 1
#define M1 2

#define P(c, m, b) PATTERN(c, m, b)
const uint8_t Patterns[] = {
    //!< パターン 0
    P(BK, M0, 7) | P(BK, M0, 6) | P(BK, M0, 5) | P(C0, M0, 4) | P(C0, M0, 3) | P(BK, M0, 2) | P(BK, M0, 1) | P(BK, M0, 0),
    P(BK, M1, 7) | P(BK, M1, 6) | P(BK, M1, 5) | P(C0, M1, 4) | P(C0, M1, 3) | P(BK, M1, 2) | P(BK, M1, 1) | P(BK, M1, 0),
    P(BK, M0, 7) | P(BK, M0, 6) | P(C0, M0, 5) | P(C0, M0, 4) | P(C0, M0, 3) | P(C0, M0, 2) | P(BK, M0, 1) | P(BK, M0, 0),
    P(BK, M1, 7) | P(BK, M1, 6) | P(C0, M1, 5) | P(C0, M1, 4) | P(C0, M1, 3) | P(C0, M1, 2) | P(BK, M1, 1) | P(BK, M1, 0),
    P(BK, M0, 7) | P(C0, M0, 6) | P(C0, M0, 5) | P(C0, M0, 4) | P(C0, M0, 3) | P(C0, M0, 2) | P(C0, M0, 1) | P(BK, M0, 0),
    P(BK, M1, 7) | P(C0, M1, 6) | P(C0, M1, 5) | P(C0, M1, 4) | P(C0, M1, 3) | P(C0, M1, 2) | P(C0, M1, 1) | P(BK, M1, 0),
    P(C0, M0, 7) | P(C0, M0, 6) | P(BK, M0, 5) | P(C0, M0, 4) | P(C0, M0, 3) | P(BK, M0, 2) | P(C0, M0, 1) | P(C0, M0, 0),
    P(C0, M1, 7) | P(C0, M1, 6) | P(BK, M1, 5) | P(C0, M1, 4) | P(C0, M1, 3) | P(BK, M1, 2) | P(C0, M1, 1) | P(C0, M1, 0),
    P(C0, M0, 7) | P(C0, M0, 6) | P(C0, M0, 5) | P(C0, M0, 4) | P(C0, M0, 3) | P(C0, M0, 2) | P(C0, M0, 1) | P(C0, M0, 0),
    P(C0, M1, 7) | P(C0, M1, 6) | P(C0, M1, 5) | P(C0, M1, 4) | P(C0, M1, 3) | P(C0, M1, 2) | P(C0, M1, 1) | P(C0, M1, 0),
    P(BK, M0, 7) | P(BK, M0, 6) | P(C0, M0, 5) | P(BK, M0, 4) | P(BK, M0, 3) | P(C0, M0, 2) | P(BK, M0, 1) | P(BK, M0, 0),
    P(BK, M1, 7) | P(BK, M1, 6) | P(C0, M1, 5) | P(BK, M1, 4) | P(BK, M1, 3) | P(C0, M1, 2) | P(BK, M1, 1) | P(BK, M1, 0),
    P(BK, M0, 7) | P(C0, M0, 6) | P(BK, M0, 5) | P(C0, M0, 4) | P(C0, M0, 3) | P(BK, M0, 2) | P(C0, M0, 1) | P(BK, M0, 0),
    P(BK, M1, 7) | P(C0, M1, 6) | P(BK, M1, 5) | P(C0, M1, 4) | P(C0, M1, 3) | P(BK, M1, 2) | P(C0, M1, 1) | P(BK, M1, 0),
    P(C0, M0, 7) | P(BK, M0, 6) | P(C0, M0, 5) | P(BK, M0, 4) | P(BK, M0, 3) | P(C0, M0, 2) | P(BK, M0, 1) | P(C0, M0, 0),
    P(C0, M1, 7) | P(BK, M1, 6) | P(C0, M1, 5) | P(BK, M1, 4) | P(BK, M1, 3) | P(C0, M1, 2) | P(BK, M1, 1) | P(C0, M1, 0),

    //!< パターン 1
    P(BK, M0, 7) | P(BK, M0, 6) | P(BK, M0, 5) | P(BK, M0, 4) | P(C1, M0, 3) | P(C1, M0, 2) | P(BK, M0, 1) | P(BK, M0, 0),
    P(BK, M1, 7) | P(BK, M1, 6) | P(BK, M1, 5) | P(BK, M1, 4) | P(C1, M1, 3) | P(C1, M1, 2) | P(BK, M1, 1) | P(BK, M1, 0),
    P(BK, M0, 7) | P(BK, M0, 6) | P(BK, M0, 5) | P(BK, M0, 4) | P(C1, M0, 3) | P(BK, M0, 2) | P(BK, M0, 1) | P(BK, M0, 0),
    P(BK, M1, 7) | P(BK, M1, 6) | P(BK, M1, 5) | P(BK, M1, 4) | P(C1, M1, 3) | P(BK, M1, 2) | P(BK, M1, 1) | P(BK, M1, 0),
    P(BK, M0, 7) | P(C1, M0, 6) | P(C1, M0, 5) | P(C1, M0, 4) | P(C1, M0, 3) | P(C1, M0, 2) | P(C1, M0, 1) | P(BK, M0, 0),
    P(BK, M1, 7) | P(C1, M1, 6) | P(C1, M1, 5) | P(C1, M1, 4) | P(C1, M1, 3) | P(C1, M1, 2) | P(C1, M1, 1) | P(BK, M1, 0),
    P(C1, M0, 7) | P(C1, M0, 6) | P(C1, M0, 5) | P(C1, M0, 4) | P(C1, M0, 3) | P(C1, M0, 2) | P(C1, M0, 1) | P(C1, M0, 0),
    P(C1, M1, 7) | P(C1, M1, 6) | P(C1, M1, 5) | P(C1, M1, 4) | P(C1, M1, 3) | P(C1, M1, 2) | P(C1, M1, 1) | P(C1, M1, 0),
    P(C1, M0, 7) | P(BK, M0, 6) | P(C1, M0, 5) | P(C1, M0, 4) | P(C1, M0, 3) | P(C1, M0, 2) | P(C1, M0, 1) | P(C1, M0, 0),
    P(C1, M1, 7) | P(BK, M1, 6) | P(C1, M1, 5) | P(C1, M1, 4) | P(C1, M1, 3) | P(C1, M1, 2) | P(C1, M1, 1) | P(C1, M1, 0),
    P(C1, M0, 7) | P(BK, M0, 6) | P(C1, M0, 5) | P(C1, M0, 4) | P(C1, M0, 3) | P(C1, M0, 2) | P(C1, M0, 1) | P(C1, M0, 0),
    P(C1, M1, 7) | P(BK, M1, 6) | P(C1, M1, 5) | P(C1, M1, 4) | P(C1, M1, 3) | P(C1, M1, 2) | P(C1, M1, 1) | P(C1, M1, 0),
    P(C1, M0, 7) | P(C1, M0, 6) | P(C1, M0, 5) | P(C1, M0, 4) | P(C1, M0, 3) | P(C1, M0, 2) | P(C1, M0, 1) | P(C1, M0, 0),
    P(C1, M1, 7) | P(C1, M1, 6) | P(C1, M1, 5) | P(C1, M1, 4) | P(C1, M1, 3) | P(C1, M1, 2) | P(C1, M1, 1) | P(C1, M1, 0),
    P(BK, M0, 7) | P(C1, M0, 6) | P(C1, M0, 5) | P(C1, M0, 4) | P(C1, M0, 3) | P(C1, M0, 2) | P(C1, M0, 1) | P(BK, M0, 0),
    P(BK, M1, 7) | P(C1, M1, 6) | P(C1, M1, 5) | P(C1, M1, 4) | P(C1, M1, 3) | P(C1, M1, 2) | P(C1, M1, 1) | P(BK, M1, 0),
};
#undef P
#undef M1
#undef M0
#undef C2
#undef C1
#undef C0
#undef BK

const uint8_t Tiles[] = {
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,
};

void main()
{
    disable_interrupts(); {
        SHOW_BKG;
        //!< BG パレット
        BGP_REG = DEFAULT_PALETTE;
        //!< BG パターン
        set_bkg_data(0, COUNTOF(Patterns), Patterns);

        DISPLAY_OFF;{ 
            //!< BG ネームテーブル (マップ)
            set_bkg_tiles(0, 0, COUNTOF(Tiles) >> 5, 32, Tiles);
        } DISPLAY_ON;
    } enable_interrupts();

    initrand(0xdeadbeef);

    while(1){
        wait_vbl_done();
    }
}